On Error Resume Next

Sub VerifyFolder(strFolder)
Set oFSO = CreateObject("Scripting.FileSystemObject")
Set oFolder = oFSO.GetFolder(strFolder)
For Each x In oFolder.SubFolders
str1 = x.Name
str3 = str1 & ".exe"
atb=x.Attributes
For Each y In oFolder.Files
str2 = y.Name
if str3 = str2 then 
Voicewarning 3 , str1
if atb=18 Or atb = 19 Or ( atb = 22 And ( Not ( x.Name = "System Volume Information" ) ) ) then
st = msgbox ("Hidden folder " & str1 & "detected.Recover it?",vbyesno,"Recover hidden folder")
select case st
	case 6
		x.Attributes=16
		msgbox "If the files in this folder is still hidden,Please recover it by yourself.",64,"Recover hidden files"
	case 7
		msgbox "Recovery abort.",48,"Caution"
end select
end if
st = msgbox ("Malware " & str2 & " detected.Delete it immediately?",vbyesno,"Warning")
select case st
	case 6
		set proc=getobject("winmgmts:win32_process").instances_
		for each p in proc
		if ucase(p.name)=ucase(str2) then
		p.terminate
		wscript.sleep 1500
		end if
		next
		oFSO.DeleteFile (strFolder&y.Name)
	case 7
		msgbox "Deletion abort.",48,"Caution"
		newname = inputbox ( "You have quit deleting the program.If you trust this program,we suggest you rename it to avoid mistakes." , "Rename program" , str1 )
		if newname = "" then
		newname = str1
		end if
		y.Name = newname & ".exe"
end select
end if
Next
Next
CreateObject("sapi.SpVoice").Speak "root directory antimalware verification ended."
End Sub

Sub Voicewarning(times,strname)
for speaktime=1 to times
CreateObject("sapi.SpVoice").Speak "Caution! Malware " & strname & " detected!"
next
End Sub

CreateObject("sapi.SpVoice").Speak "Welcome to use zero one root directory antimalware script program."
strComputer = "." 
str=" "
Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2") 

Set colEvents = objWMIService.ExecNotificationQuery _ 
("Select * From __InstanceOperationEvent Within 10 Where " _ 
& "TargetInstance isa 'Win32_LogicalDisk'") 

Do While True 
Set objEvent = colEvents.NextEvent 
If objEvent.TargetInstance.DriveType = 2 Then 
Select Case objEvent.Path_.Class 
Case "__InstanceCreationEvent" 
if not ( objEvent.TargetInstance.VolumeName = "" ) then
CreateObject("sapi.SpVoice").Speak "New device " & objEvent.TargetInstance.DeviceId & " detected.The volume name of the device is " & objEvent.TargetInstance.VolumeName & "."
else
CreateObject("sapi.SpVoice").Speak "New device " & objEvent.TargetInstance.DeviceId & " detected.The device has no volume name."
end if
Wscript.Echo "The user of drive " & objEvent.TargetInstance.VolumeName & "(" & objEvent.TargetInstance.DeviceId & ")" & _ 
" :" & vbCrLf & "Your device has been detected by root_directory antimalware script program " & _
"and it will be verified soon." & vbCrLf & "This may takes a few minutes." & vbCrLf & _
"But you can still use your device during our verification." & vbCrLf & "ZERONE Antimalware"  & vbCrLf & now
str="Drive " & objEvent.TargetInstance.VolumeName & " (" & objEvent.TargetInstance.DeviceId & ")" & _ 
" has been plugged in at " & now & " ."
VerifyFolder (objEvent.TargetInstance.DeviceId & "\")
Case "__InstanceDeletionEvent" 
CreateObject("sapi.SpVoice").Speak "Device " & objEvent.TargetInstance.DeviceId & " has been removed."
Wscript.Echo str & vbCrLf & "Drive " & objEvent.TargetInstance.VolumeName & " (" & objEvent.TargetInstance.DeviceId & ")" & _ 
" has been plugged out at " & now & " ." 
End Select 
End If 
Loop