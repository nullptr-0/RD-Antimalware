
on error resume next
CreateObject("sapi.SpVoice").Speak "Root directory防病毒程序辅助脚本2开始运行."
flag = 1
strComputer = "." 
Set ws = WScript.CreateObject("WScript.Shell")
strPath = WScript.ScriptFullName
Set objws = CreateObject("Scripting.FileSystemObject")

Set objFile = objws.GetFile(strPath)

strFolder = objws.GetParentFolderName(objFile)
Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2")

Set colEvents = objWMIService.ExecNotificationQuery ("SELECT * FROM __InstanceOperationEvent WITHIN 1 WHERE " & "TargetInstance ISA 'Win32_LogicalDisk'")

Set objWinMgmt = GetObject("WinMgmts:Root\Cimv2")

While true
    Set colProcess = objWinMgmt.ExecQuery ("Select * From Win32_Process where name = 'wscript.exe'")

    call procheck(colProcess, "antimalware_root directory private automated.vbs")
    Set colProcess = objWinMgmt.ExecQuery ("Select * From Win32_Process where name = 'wscript.exe'")

    call procheck(colProcess, "Agent1.vbs")

Wend

sub procheck(checkme, procname)


For Each objProcess In checkme

    vaprocess = objProcess.CommandLine


        if instr(vaprocess, procname) then
		if procname="antimalware_root directory private automated.vbs" And flag=1 then
			flag=0
			CreateObject("sapi.SpVoice").Speak "Root directory防病毒脚本运行正常."
		End if
		Exit sub

        End if


Next

ws.Run Chr(34) & strFolder  & "\" & procname & Chr(34)

end sub