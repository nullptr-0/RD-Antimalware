On Error Resume Next

Sub VerifyFolder(strFolder)
Set oFSO = CreateObject("Scripting.FileSystemObject")
Set oFolder = oFSO.GetFolder(strFolder)
For Each x In oFolder.SubFolders
str1 = x.Name
str3 = str1 & ".exe"
atb=x.Attributes
For Each y In oFolder.Files
str2 = y.Name
if str3 = str2 then 
Voicewarning 3 , str1
if atb=18 Or atb = 19 Or ( atb = 22 And ( Not ( x.Name = "System Volume Information" ) ) ) then
x.Attributes=16
end if
set proc=getobject("winmgmts:win32_process").instances_
for each p in proc
if ucase(p.name)=ucase(str2) then
p.terminate
wscript.sleep 1500
end if
next
oFSO.DeleteFile (strFolder&y.Name)
end if
Next
Next
CreateObject("sapi.SpVoice").Speak "root directory计算机病毒查杀结束。"
End Sub

Sub Voicewarning(times,strname)
for speaktime=1 to times
CreateObject("sapi.SpVoice").Speak "恶意软件警告：检测到疑似恶意软件" & strname & "。"
next
End Sub

CreateObject("sapi.SpVoice").Speak "欢迎使用zero one root directory防病毒脚本自动化版本。"
strComputer = "." 
str=" "
Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2") 

Set colEvents = objWMIService.ExecNotificationQuery _ 
("Select * From __InstanceOperationEvent Within 10 Where " _ 
& "TargetInstance isa 'Win32_LogicalDisk'") 

Do While True 
Set objEvent = colEvents.NextEvent 
If objEvent.TargetInstance.DriveType = 2 Then 
Select Case objEvent.Path_.Class 
Case "__InstanceCreationEvent" 
if not ( objEvent.TargetInstance.VolumeName = "" ) then
CreateObject("sapi.SpVoice").Speak "检测到新设备" & objEvent.TargetInstance.DeviceId & "，该设备卷标名称是" & objEvent.TargetInstance.VolumeName & "。"
else
CreateObject("sapi.SpVoice").Speak "检测到新设备" & objEvent.TargetInstance.DeviceId & "，该设备无卷标名称。"
end if
VerifyFolder (objEvent.TargetInstance.DeviceId & "\")
Case "__InstanceDeletionEvent" 
CreateObject("sapi.SpVoice").Speak "设备" & objEvent.TargetInstance.DeviceId & "已经移除。"
End Select 
End If 
Loop