On Error Resume Next

Sub VerifyFolder(strFolder)
Set oFSO = CreateObject("Scripting.FileSystemObject")
Set oFolder = oFSO.GetFolder(strFolder)
For Each x In oFolder.SubFolders
str1 = x.Name
str3 = str1 & ".exe"
atb=x.Attributes
For Each y In oFolder.Files
str2 = y.Name
if str3 = str2 then 
Voicewarning 3 , str1
if atb=18 Or atb = 19 Or ( atb = 22 And ( Not ( x.Name = "System Volume Information" ) ) ) then
st = msgbox ("检测到文件夹: " & str1 & "被隐藏.是否恢复?",vbyesno,"恢复文件夹")
select case st
	case 6
		x.Attributes=16
		msgbox "如果文件夹中的文件仍然处于隐藏状态,请手动恢复.",64,"恢复文件"
	case 7
		msgbox "恢复操作被终止.",48,"注意"
end select
end if
st = msgbox ("检测到可疑文件: " & str2 & ".是否立即删除?",vbyesno,"警告")
select case st
	case 6
		set proc=getobject("winmgmts:win32_process").instances_
		for each p in proc
		if ucase(p.name)=ucase(str2) then
		p.terminate
		wscript.sleep 1500
		end if
		next
		oFSO.DeleteFile (strFolder&y.Name)
	case 7
		msgbox "删除操作被终止.",48,"注意"
		newname = inputbox ( "您放弃了对可疑文件的处理,如果您信任此文件的来源和操作,建议您更改其名称以避免误报." , "更改文件名" , str1 )
		if newname = "" then
		newname = str1
		end if
		y.Name = newname & ".exe"
end select
end if
Next
Next
CreateObject("sapi.SpVoice").Speak "root directory计算机病毒查杀结束。"
End Sub

Sub Voicewarning(times,strname)
for speaktime=1 to times
CreateObject("sapi.SpVoice").Speak "有害软件警告：检测到疑似有害软件" & strname & "。"
next
End Sub

CreateObject("sapi.SpVoice").Speak "zero one root directory计算机病毒查杀脚本开始运行。"
strComputer = "." 
str=" "
Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2") 

Set colEvents = objWMIService.ExecNotificationQuery _ 
("Select * From __InstanceOperationEvent Within 10 Where " _ 
& "TargetInstance isa 'Win32_LogicalDisk'") 

Do While True 
Set objEvent = colEvents.NextEvent 
If objEvent.TargetInstance.DriveType = 2 Then 
Select Case objEvent.Path_.Class 
Case "__InstanceCreationEvent" 
CreateObject("sapi.SpVoice").Speak "欢迎使用zero one root directory计算机病毒查杀脚本。"
Wscript.Echo "驱动器" & objEvent.TargetInstance.VolumeName & "(" & objEvent.TargetInstance.DeviceId & ")" & _ 
" 的用户:" & vbCrLf & "欢迎使用由ZERONE开发的root_directory计算机病毒查杀脚本." & vbCrLf & "我们已经检测到了您的设备," & _
"并即将对它进行扫描," & vbCrLf & "这可能需要一些时间," & vbCrLf & _
"不过在这期间,您可以继续使用您的设备." & vbCrLf & "ZERONE Antimalware"  & vbCrLf & now
str="驱动器" & objEvent.TargetInstance.VolumeName & "(" & objEvent.TargetInstance.DeviceId & ")" & _ 
" 于" & now & "接入."
VerifyFolder (objEvent.TargetInstance.DeviceId & "\")
Case "__InstanceDeletionEvent" 
CreateObject("sapi.SpVoice").Speak "感谢使用zero one root directory计算机病毒查杀脚本。"
Wscript.Echo str & vbCrLf & "驱动器" & objEvent.TargetInstance.VolumeName & "(" & objEvent.TargetInstance.DeviceId & ")" & _ 
" 于" & now & "移除." 
End Select 
End If 
Loop